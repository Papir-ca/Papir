<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Card Designer - Papir</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;600;700&family=Great+Vibes&family=EB+Garamond:wght@400;600;800&family=Parisienne&family=Sorts+Mill+Goudy&family=Lato:wght@300;400;700&family=Open+Sans:wght@300;400;600;700&family=Raleway:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&family=Libre+Baskerville:wght@400;700&family=Old+Standard+TT:wght@400;700&family=Cinzel:wght@400;700;900&family=Alex+Brush&family=Allura&family=Sacramento&family=Dancing+Script:wght@400;700&family=Pacifico&family=Quicksand:wght@300;400;600&family=Times+New+Roman&family=Georgia&family=Garamond&family=Palatino&family=Book+Antiqua&family=Didot&family=Bodoni+Moda&family=Franklin+Gothic+Medium&family=Helvetica&family=Arial&family=Verdana&family=Tahoma&family=Trebuchet+MS&family=Impact&family=Comic+Sans+MS&family=Courier+New&family=Brush+Script+MT&family=Lucida+Handwriting&family=Segoe+Script&family=Script+MT+Bold&family=Edwardian+Script+ITC&family=French+Script+MT&family=Monotype+Corsiva&family=Sofia&family=Style+Script&family=Tangerine&family=Mr+Dafoe&family=Allison&family=Waterfall&family=Hurricane&family=Mea+Culpa&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #BCAE83;
            --primary-teal: #06D6A0;
            --dark-bg: #1a1a1a;
            --light-bg: #f5f5f5;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --border-light: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .design-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 15px;
        }

        .design-header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .template-badge {
            background: var(--primary-gold);
            color: var(--dark-bg);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .price-display {
            background: var(--primary-teal);
            color: white;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .design-layout {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
            height: calc(100vh - 120px);
        }

        .tools-panel {
            width: 80px;
            background: white;
            border-radius: 15px;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow);
            overflow-y: auto;
        }

        .tool-btn {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .tool-btn:hover {
            background: rgba(188, 174, 131, 0.1);
            color: var(--primary-gold);
        }

        .tool-btn.active {
            background: var(--primary-gold);
            color: white;
        }

        .tool-btn[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--dark-bg);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
        }

        .canvas-area {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: auto;
        }

        .canvas-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-light);
        }

        .page-controls {
            display: flex;
            gap: 10px;
        }

        .page-btn {
            padding: 8px 20px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .page-btn.active {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
            color: white;
        }

        .zoom-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .zoom-btn {
            width: 35px;
            height: 35px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .zoom-btn:hover {
            border-color: var(--primary-gold);
        }

        #zoomLevel {
            min-width: 60px;
            text-align: center;
            color: var(--dark-bg);
        }

        .canvas-container {
            flex: 1;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: border 0.3s ease;
        }

        #designCanvas {
            border: 2px solid #ddd;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            background: white;
        }

        .properties-panel {
            width: 400px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            overflow-y: auto;
            color: var(--dark-bg);
        }

        .properties-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 10px;
        }

        .properties-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .property-section {
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 20px;
        }

        .property-section h4 {
            margin-bottom: 15px;
            color: #555;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .property-row {
            margin-bottom: 15px;
        }

        .property-label {
            display: flex;
            justify-content: space-between;
            color: #666;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .property-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .property-input:focus {
            border-color: var(--primary-gold);
            outline: none;
        }

        .text-input-area {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        .text-input-area:focus {
            border-color: var(--primary-gold);
            outline: none;
        }

        .color-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="color"] {
            width: 50px;
            height: 40px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            cursor: pointer;
        }

        .slider-with-value {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .slider-with-value input[type="range"] {
            flex: 1;
        }

        .slider-with-value input[type="number"] {
            width: 70px;
            padding: 5px;
            border: 2px solid var(--border-light);
            border-radius: 5px;
            text-align: center;
        }

        .font-selector {
            width: 100%;
            padding: 8px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 0.95rem;
            max-height: 200px;
        }

        .border-style-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .border-style-option {
            padding: 8px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .border-style-option:hover {
            border-color: var(--primary-gold);
        }

        .border-style-option.active {
            border-color: var(--primary-gold);
            background: rgba(188, 174, 131, 0.1);
        }

        .text-effect-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .effect-btn {
            width: 35px;
            height: 35px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .effect-btn:hover,
        .effect-btn.active {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
            color: white;
        }

        .alignment-buttons {
            display: flex;
            gap: 5px;
        }

        .align-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .align-btn:hover,
        .align-btn.active {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
            color: white;
        }

        .bullet-options {
            display: flex;
            gap: 10px;
        }

        .bullet-option {
            flex: 1;
            padding: 8px;
            border: 2px solid var(--border-light);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bullet-option:hover,
        .bullet-option.active {
            border-color: var(--primary-gold);
            background: rgba(188, 174, 131, 0.1);
        }

        .lock-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
        }

        .lock-toggle i {
            color: var(--primary-gold);
            font-size: 1.2rem;
        }

        .upload-area {
            border: 2px dashed var(--border-light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .upload-area:hover {
            border-color: var(--primary-gold);
            background: rgba(188, 174, 131, 0.05);
        }

        .graphics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .graphic-item {
            aspect-ratio: 1;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.5rem;
            color: #666;
        }

        .graphic-item:hover {
            border-color: var(--primary-gold);
            transform: scale(1.05);
            background: rgba(188, 174, 131, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 2;
            padding: 12px;
            background: linear-gradient(to right, var(--primary-gold), #a8996f);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(188, 174, 131, 0.3);
        }

        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: white;
            color: var(--dark-bg);
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: var(--primary-gold);
        }

        .layers-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 5px;
        }

        .layer-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 2px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-item:hover {
            background: #f5f5f5;
        }

        .layer-item.active {
            background: rgba(188, 174, 131, 0.1);
            border-left: 3px solid var(--primary-gold);
        }

        .layer-icon {
            width: 20px;
            color: var(--primary-gold);
        }

        .layer-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .layer-actions {
            display: flex;
            gap: 5px;
        }

        .layer-action-btn {
            width: 25px;
            height: 25px;
            border: none;
            background: transparent;
            border-radius: 3px;
            cursor: pointer;
            color: #999;
        }

        .layer-action-btn:hover {
            background: #f0f0f0;
            color: var(--primary-gold);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="design-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <a href="templates.html" style="color: white; text-decoration: none;">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
                <h1><i class="fas fa-magic"></i> Professional Card Designer</h1>
                <span class="template-badge" id="templateName">Chantilly Lace</span>
            </div>
            <div class="price-display">
                <i class="fas fa-tag"></i> $19.99
            </div>
        </div>

        <div class="design-layout">
            <div class="tools-panel">
                <button class="tool-btn active" data-tool="select" data-tooltip="Select (V)">
                    <i class="fas fa-mouse-pointer"></i>
                </button>
                <button class="tool-btn" data-tool="text" data-tooltip="Add Text (T)">
                    <i class="fas fa-font"></i>
                </button>
                <button class="tool-btn" data-tool="image" data-tooltip="Add Image (I)">
                    <i class="fas fa-image"></i>
                </button>
                <button class="tool-btn" data-tool="shape" data-tooltip="Add Shape (S)">
                    <i class="fas fa-shapes"></i>
                </button>
                <button class="tool-btn" data-tool="graphic" data-tooltip="Add Graphic (G)">
                    <i class="fas fa-star"></i>
                </button>
                <div style="width: 100%; height: 1px; background: var(--border-light); margin: 10px 0;"></div>
                <button class="tool-btn" data-tool="layers" data-tooltip="Layers">
                    <i class="fas fa-layers"></i>
                </button>
                <button class="tool-btn" data-tool="duplicate" data-tooltip="Duplicate (Ctrl+D)">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="tool-btn" data-tool="delete" data-tooltip="Delete (Del)">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="tool-btn" data-tool="undo" data-tooltip="Undo (Ctrl+Z)">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="tool-btn" data-tool="redo" data-tooltip="Redo (Ctrl+Y)">
                    <i class="fas fa-redo"></i>
                </button>
            </div>

            <div class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="page-controls">
                        <button class="page-btn active" data-page="front">Front</button>
                        <button class="page-btn" data-page="back">Back</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoomOut"><i class="fas fa-search-minus"></i></button>
                        <span id="zoomLevel">100%</span>
                        <button class="zoom-btn" id="zoomIn"><i class="fas fa-search-plus"></i></button>
                        <button class="zoom-btn" id="zoomFit"><i class="fas fa-expand"></i></button>
                    </div>
                </div>
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="designCanvas" width="600" height="450"></canvas>
                </div>
            </div>

            <div class="properties-panel" id="propertiesPanel">
                <div class="properties-header">
                    <h3><i class="fas fa-sliders-h"></i> Properties</h3>
                    <span style="color: var(--primary-gold);" id="selectedObjectType">No Selection</span>
                </div>

                <div id="textProperties" style="display: none;">
                    <div class="property-section">
                        <h4><i class="fas fa-pen"></i> Edit Text</h4>
                        <textarea class="text-input-area" id="textContent" placeholder="Type your text here...">Sample Text</textarea>
                    </div>

                    <div class="property-section">
                        <h4><i class="fas fa-font"></i> Typography</h4>
                        <div class="property-row">
                            <label class="property-label">Font Family</label>
                            <select class="font-selector" id="fontFamily" size="5">
                                <optgroup label="Elegant Serif">
                                    <option value="Playfair Display">Playfair Display</option>
                                    <option value="Cormorant Garamond">Cormorant Garamond</option>
                                    <option value="EB Garamond">EB Garamond</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Garamond">Garamond</option>
                                    <option value="Palatino">Palatino</option>
                                    <option value="Book Antiqua">Book Antiqua</option>
                                    <option value="Didot">Didot</option>
                                    <option value="Bodoni Moda">Bodoni Moda</option>
                                </optgroup>
                                <optgroup label="Script & Handwriting">
                                    <option value="Great Vibes">Great Vibes</option>
                                    <option value="Parisienne">Parisienne</option>
                                    <option value="Alex Brush">Alex Brush</option>
                                    <option value="Allura">Allura</option>
                                    <option value="Sacramento">Sacramento</option>
                                    <option value="Dancing Script">Dancing Script</option>
                                    <option value="Pacifico">Pacifico</option>
                                    <option value="Sofia">Sofia</option>
                                    <option value="Style Script">Style Script</option>
                                    <option value="Tangerine">Tangerine</option>
                                    <option value="Brush Script MT">Brush Script MT</option>
                                    <option value="Lucida Handwriting">Lucida Handwriting</option>
                                    <option value="Segoe Script">Segoe Script</option>
                                    <option value="Script MT Bold">Script MT Bold</option>
                                    <option value="Edwardian Script ITC">Edwardian Script ITC</option>
                                    <option value="French Script MT">French Script MT</option>
                                    <option value="Monotype Corsiva">Monotype Corsiva</option>
                                    <option value="Mr Dafoe">Mr Dafoe</option>
                                    <option value="Allison">Allison</option>
                                    <option value="Waterfall">Waterfall</option>
                                    <option value="Hurricane">Hurricane</option>
                                    <option value="Mea Culpa">Mea Culpa</option>
                                </optgroup>
                                <optgroup label="Sans Serif">
                                    <option value="Montserrat">Montserrat</option>
                                    <option value="Lato">Lato</option>
                                    <option value="Open Sans">Open Sans</option>
                                    <option value="Raleway">Raleway</option>
                                    <option value="Roboto">Roboto</option>
                                    <option value="Helvetica">Helvetica</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Verdana">Verdana</option>
                                    <option value="Tahoma">Tahoma</option>
                                    <option value="Trebuchet MS">Trebuchet MS</option>
                                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                                    <option value="Quicksand">Quicksand</option>
                                </optgroup>
                                <optgroup label="Display">
                                    <option value="Cinzel">Cinzel</option>
                                    <option value="Impact">Impact</option>
                                    <option value="Comic Sans MS">Comic Sans MS</option>
                                    <option value="Courier New">Courier New</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Font Size</label>
                            <div class="slider-with-value">
                                <input type="range" id="fontSizeSlider" min="8" max="200" value="48">
                                <input type="number" id="fontSizeNumber" min="8" max="200" value="48">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Color</label>
                            <div class="color-row">
                                <input type="color" id="textColor" value="#333333">
                                <input type="text" class="property-input" id="textColorHex" value="#333333" maxlength="7">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Opacity</label>
                            <div class="slider-with-value">
                                <input type="range" id="textOpacitySlider" min="0" max="100" value="100">
                                <input type="number" id="textOpacityNumber" min="0" max="100" value="100">%
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Text Effects</label>
                            <div class="text-effect-buttons">
                                <button class="effect-btn" id="textBold"><i class="fas fa-bold"></i></button>
                                <button class="effect-btn" id="textItalic"><i class="fas fa-italic"></i></button>
                                <button class="effect-btn" id="textUnderline"><i class="fas fa-underline"></i></button>
                                <button class="effect-btn" id="textStrikethrough"><i class="fas fa-strikethrough"></i></button>
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Alignment</label>
                            <div class="alignment-buttons">
                                <button class="align-btn" data-align="left"><i class="fas fa-align-left"></i></button>
                                <button class="align-btn" data-align="center"><i class="fas fa-align-center"></i></button>
                                <button class="align-btn" data-align="right"><i class="fas fa-align-right"></i></button>
                                <button class="align-btn" data-align="justify"><i class="fas fa-align-justify"></i></button>
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Line Height</label>
                            <div class="slider-with-value">
                                <input type="range" id="lineHeightSlider" min="0.8" max="3" step="0.1" value="1.2">
                                <input type="number" id="lineHeightNumber" min="0.8" max="3" step="0.1" value="1.2">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Letter Spacing</label>
                            <div class="slider-with-value">
                                <input type="range" id="letterSpacingSlider" min="-2" max="10" step="0.5" value="0">
                                <input type="number" id="letterSpacingNumber" min="-2" max="10" step="0.5" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="imageProperties" style="display: none;">
                    <div class="property-section">
                        <h4><i class="fas fa-image"></i> Image Settings</h4>
                        <div class="property-row">
                            <label class="property-label">Opacity</label>
                            <div class="slider-with-value">
                                <input type="range" id="imageOpacitySlider" min="0" max="100" value="100">
                                <input type="number" id="imageOpacityNumber" min="0" max="100" value="100">%
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Flip</label>
                            <div style="display: flex; gap: 10px;">
                                <button class="effect-btn" id="flipHorizontal"><i class="fas fa-arrows-alt-h"></i> H</button>
                                <button class="effect-btn" id="flipVertical"><i class="fas fa-arrows-alt-v"></i> V</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="shapeProperties" style="display: none;">
                    <div class="property-section">
                        <h4><i class="fas fa-shapes"></i> Shape Settings</h4>
                        <div class="property-row">
                            <label class="property-label">Fill Color</label>
                            <div class="color-row">
                                <input type="color" id="shapeFillColor" value="#BCAE83">
                                <input type="text" class="property-input" id="shapeFillHex" value="#BCAE83">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Stroke Color</label>
                            <div class="color-row">
                                <input type="color" id="shapeStrokeColor" value="#000000">
                                <input type="text" class="property-input" id="shapeStrokeHex" value="#000000">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Stroke Width</label>
                            <div class="slider-with-value">
                                <input type="range" id="strokeWidthSlider" min="0" max="20" value="2">
                                <input type="number" id="strokeWidthNumber" min="0" max="20" value="2">
                            </div>
                        </div>
                        <div class="property-row">
                            <label class="property-label">Opacity</label>
                            <div class="slider-with-value">
                                <input type="range" id="shapeOpacitySlider" min="0" max="100" value="100">
                                <input type="number" id="shapeOpacityNumber" min="0" max="100" value="100">%
                            </div>
                        </div>
                    </div>
                </div>

                <div class="property-section">
                    <h4><i class="fas fa-object-group"></i> Transform & Position</h4>
                    <div class="property-row">
                        <div class="lock-toggle" id="lockToggle">
                            <i class="fas fa-unlock" id="lockIcon"></i>
                            <span id="lockText">Unlocked - Click to lock position</span>
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Position X</label>
                        <div class="slider-with-value">
                            <input type="range" id="posXSlider" min="0" max="600" value="0">
                            <input type="number" id="posXNumber" min="0" max="600" value="0">
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Position Y</label>
                        <div class="slider-with-value">
                            <input type="range" id="posYSlider" min="0" max="450" value="0">
                            <input type="number" id="posYNumber" min="0" max="450" value="0">
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Width</label>
                        <div class="slider-with-value">
                            <input type="range" id="widthSlider" min="10" max="600" value="100">
                            <input type="number" id="widthNumber" min="10" max="600" value="100">
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Height</label>
                        <div class="slider-with-value">
                            <input type="range" id="heightSlider" min="10" max="450" value="100">
                            <input type="number" id="heightNumber" min="10" max="450" value="100">
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Rotation</label>
                        <div class="slider-with-value">
                            <input type="range" id="rotationSlider" min="0" max="360" value="0">
                            <input type="number" id="rotationNumber" min="0" max="360" value="0">Â°
                        </div>
                    </div>
                </div>

                <div class="property-section">
                    <h4><i class="fas fa-border-all"></i> Card Border</h4>
                    <div class="property-row">
                        <label class="property-label">Border Style</label>
                        <div class="border-style-grid" id="borderStyleGrid">
                            <div class="border-style-option active" data-border="none">None</div>
                            <div class="border-style-option" data-border="solid">Solid</div>
                            <div class="border-style-option" data-border="dashed">Dashed</div>
                            <div class="border-style-option" data-border="dotted">Dotted</div>
                            <div class="border-style-option" data-border="double">Double</div>
                            <div class="border-style-option" data-border="groove">Groove</div>
                            <div class="border-style-option" data-border="ridge">Ridge</div>
                            <div class="border-style-option" data-border="inset">Inset</div>
                            <div class="border-style-option" data-border="outset">Outset</div>
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Border Color</label>
                        <div class="color-row">
                            <input type="color" id="borderColor" value="#D4AF37">
                            <input type="text" class="property-input" id="borderColorHex" value="#D4AF37">
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Border Width</label>
                        <div class="slider-with-value">
                            <input type="range" id="borderWidthSlider" min="0" max="20" value="3">
                            <input type="number" id="borderWidthNumber" min="0" max="20" value="3">px
                        </div>
                    </div>
                    <div class="property-row">
                        <label class="property-label">Border Radius</label>
                        <div class="slider-with-value">
                            <input type="range" id="borderRadiusSlider" min="0" max="50" value="0">
                            <input type="number" id="borderRadiusNumber" min="0" max="50" value="0">px
                        </div>
                    </div>
                </div>

                <div class="property-section">
                    <h4><i class="fas fa-star"></i> Graphics Library</h4>
                    <div class="graphics-grid" id="graphicsGrid">
                        <div class="graphic-item" data-graphic="heart"><i class="fas fa-heart"></i></div>
                        <div class="graphic-item" data-graphic="star"><i class="fas fa-star"></i></div>
                        <div class="graphic-item" data-graphic="flower"><i class="fas fa-seedling"></i></div>
                        <div class="graphic-item" data-graphic="crown"><i class="fas fa-crown"></i></div>
                        <div class="graphic-item" data-graphic="diamond"><i class="fas fa-gem"></i></div>
                        <div class="graphic-item" data-graphic="circle"><i class="fas fa-circle"></i></div>
                        <div class="graphic-item" data-graphic="square"><i class="fas fa-square"></i></div>
                        <div class="graphic-item" data-graphic="triangle"><i class="fas fa-play"></i></div>
                        <div class="graphic-item" data-graphic="ribbon"><i class="fas fa-ribbon"></i></div>
                        <div class="graphic-item" data-graphic="heart"><i class="fas fa-heart"></i></div>
                        <div class="graphic-item" data-graphic="star"><i class="fas fa-star"></i></div>
                        <div class="graphic-item" data-graphic="flower"><i class="fas fa-seedling"></i></div>
                    </div>
                </div>

                <div class="property-section">
                    <h4><i class="fas fa-layers"></i> Layers</h4>
                    <div class="layers-list" id="layersList"></div>
                </div>

                <div class="property-section">
                    <h4><i class="fas fa-cloud-upload-alt"></i> Upload</h4>
                    <div class="upload-area" id="imageUpload">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <div>Click to upload image from device</div>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn-primary" id="saveBtn">
                <i class="fas fa-save"></i> Save Design
            </button>
            <button class="btn-secondary" id="previewBtn">
                <i class="fas fa-eye"></i> Preview
            </button>
            <button class="btn-secondary" id="resetBtn">
                <i class="fas fa-undo-alt"></i> Reset
            </button>
        </div>
    </div>

    <div id="previewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; flex-direction: column;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90%; max-height: 90%; overflow: auto;">
            <img id="previewImage" style="max-width: 100%; max-height: 70vh; border-radius: 10px;">
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-primary" id="closePreviewBtn">Close Preview</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = new fabric.Canvas('designCanvas');
        let selectedObject = null;
        let currentPage = 'front';
        let zoomLevel = 1;
        let undoStack = [];
        let redoStack = [];
        let frontCanvasState = null;
        let backCanvasState = null;

        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('templateName').textContent = urlParams.get('template')?.replace(/-/g, ' ') || 'Chantilly Lace';

        function saveState() {
            undoStack.push(JSON.stringify(canvas));
            redoStack = [];
        }

        function initializeCard() {
            canvas.clear();

            const invitationLine = new fabric.Text('You are invited to the wedding of', {
                left: 50,
                top: 80,
                fontSize: 14,
                fontFamily: 'Playfair Display',
                fill: '#666666',
                fontWeight: 'normal',
                charSpacing: 20,
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const name1 = new fabric.Text('Morgan', {
                left: 50,
                top: 120,
                fontSize: 48,
                fontFamily: 'Playfair Display',
                fill: '#333333',
                fontWeight: 'bold',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const and = new fabric.Text('and', {
                left: 50,
                top: 180,
                fontSize: 18,
                fontFamily: 'Playfair Display',
                fill: '#666666',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const name2 = new fabric.Text('Elijah', {
                left: 50,
                top: 220,
                fontSize: 48,
                fontFamily: 'Playfair Display',
                fill: '#333333',
                fontWeight: 'bold',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const date = new fabric.Text('may 16, 2027 at 6 in the evening', {
                left: 50,
                top: 290,
                fontSize: 24,
                fontFamily: 'Playfair Display',
                fill: '#BCAE83',
                fontWeight: '600',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const church = new fabric.Text('saint raleigh church', {
                left: 50,
                top: 330,
                fontSize: 18,
                fontFamily: 'Playfair Display',
                fill: '#666666',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const address = new fabric.Text('496 fullerton street, monterey, ...', {
                left: 50,
                top: 360,
                fontSize: 14,
                fontFamily: 'Playfair Display',
                fill: '#888888',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            const reception = new fabric.Text('dinner and dancing to follow', {
                left: 50,
                top: 390,
                fontSize: 16,
                fontFamily: 'Playfair Display',
                fill: '#777777',
                fontStyle: 'italic',
                selectable: true,
                hasControls: true,
                hasBorders: true
            });

            canvas.add(invitationLine, name1, and, name2, date, church, address, reception);
            canvas.renderAll();
            updateLayersList();
            saveState();
        }

        initializeCard();

        canvas.on('selection:created', (e) => {
            selectedObject = e.selected[0];
            updatePropertiesPanel();
        });

        canvas.on('selection:updated', (e) => {
            selectedObject = e.selected[0];
            updatePropertiesPanel();
        });

        canvas.on('selection:cleared', () => {
            selectedObject = null;
            hideAllPropertySections();
            document.getElementById('selectedObjectType').textContent = 'No Selection';
        });

        canvas.on('object:modified', () => {
            if (selectedObject) {
                updatePropertiesPanel();
            }
            updateLayersList();
            saveState();
        });

        function hideAllPropertySections() {
            document.getElementById('textProperties').style.display = 'none';
            document.getElementById('imageProperties').style.display = 'none';
            document.getElementById('shapeProperties').style.display = 'none';
        }

        function updatePropertiesPanel() {
            if (!selectedObject) return;

            hideAllPropertySections();

            if (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text') {
                document.getElementById('textProperties').style.display = 'block';
                document.getElementById('selectedObjectType').textContent = 'Text Element';
                
                document.getElementById('textContent').value = selectedObject.text || '';
                document.getElementById('fontFamily').value = selectedObject.fontFamily || 'Playfair Display';
                document.getElementById('fontSizeSlider').value = selectedObject.fontSize || 48;
                document.getElementById('fontSizeNumber').value = selectedObject.fontSize || 48;
                document.getElementById('textColor').value = selectedObject.fill || '#333333';
                document.getElementById('textColorHex').value = selectedObject.fill || '#333333';
                document.getElementById('textOpacitySlider').value = (selectedObject.opacity || 1) * 100;
                document.getElementById('textOpacityNumber').value = (selectedObject.opacity || 1) * 100;
                
                document.getElementById('textBold').classList.toggle('active', selectedObject.fontWeight === 'bold');
                document.getElementById('textItalic').classList.toggle('active', selectedObject.fontStyle === 'italic');
                document.getElementById('textUnderline').classList.toggle('active', selectedObject.underline === true);
                document.getElementById('textStrikethrough').classList.toggle('active', selectedObject.linethrough === true);
                
                document.querySelectorAll('.align-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.align === selectedObject.textAlign) {
                        btn.classList.add('active');
                    }
                });

                document.getElementById('lineHeightSlider').value = selectedObject.lineHeight || 1.2;
                document.getElementById('lineHeightNumber').value = selectedObject.lineHeight || 1.2;
                document.getElementById('letterSpacingSlider').value = (selectedObject.charSpacing || 0) / 100;
                document.getElementById('letterSpacingNumber').value = (selectedObject.charSpacing || 0) / 100;
            }
            else if (selectedObject.type === 'image') {
                document.getElementById('imageProperties').style.display = 'block';
                document.getElementById('selectedObjectType').textContent = 'Image';
                
                document.getElementById('imageOpacitySlider').value = (selectedObject.opacity || 1) * 100;
                document.getElementById('imageOpacityNumber').value = (selectedObject.opacity || 1) * 100;
            }
            else if (selectedObject.type === 'rect' || selectedObject.type === 'circle' || selectedObject.type === 'triangle') {
                document.getElementById('shapeProperties').style.display = 'block';
                document.getElementById('selectedObjectType').textContent = 'Shape';
                
                document.getElementById('shapeFillColor').value = selectedObject.fill || '#BCAE83';
                document.getElementById('shapeFillHex').value = selectedObject.fill || '#BCAE83';
                document.getElementById('shapeStrokeColor').value = selectedObject.stroke || '#000000';
                document.getElementById('shapeStrokeHex').value = selectedObject.stroke || '#000000';
                document.getElementById('strokeWidthSlider').value = selectedObject.strokeWidth || 0;
                document.getElementById('strokeWidthNumber').value = selectedObject.strokeWidth || 0;
                document.getElementById('shapeOpacitySlider').value = (selectedObject.opacity || 1) * 100;
                document.getElementById('shapeOpacityNumber').value = (selectedObject.opacity || 1) * 100;
            }

            updateTransformProperties();
        }

        function updateTransformProperties() {
            if (!selectedObject) return;
            
            document.getElementById('posXSlider').value = Math.round(selectedObject.left || 0);
            document.getElementById('posXNumber').value = Math.round(selectedObject.left || 0);
            document.getElementById('posYSlider').value = Math.round(selectedObject.top || 0);
            document.getElementById('posYNumber').value = Math.round(selectedObject.top || 0);
            document.getElementById('widthSlider').value = Math.round((selectedObject.width || 100) * (selectedObject.scaleX || 1));
            document.getElementById('widthNumber').value = Math.round((selectedObject.width || 100) * (selectedObject.scaleX || 1));
            document.getElementById('heightSlider').value = Math.round((selectedObject.height || 100) * (selectedObject.scaleY || 1));
            document.getElementById('heightNumber').value = Math.round((selectedObject.height || 100) * (selectedObject.scaleY || 1));
            document.getElementById('rotationSlider').value = Math.round(selectedObject.angle || 0);
            document.getElementById('rotationNumber').value = Math.round(selectedObject.angle || 0);

            const isLocked = selectedObject.lockMovementX === true;
            document.getElementById('lockIcon').className = isLocked ? 'fas fa-lock' : 'fas fa-unlock';
            document.getElementById('lockText').textContent = isLocked ? 'Locked - Click to unlock' : 'Unlocked - Click to lock position';
        }

        document.getElementById('lockToggle').addEventListener('click', () => {
            if (selectedObject) {
                const isLocked = !selectedObject.lockMovementX;
                selectedObject.set({
                    lockMovementX: isLocked,
                    lockMovementY: isLocked,
                    lockScalingX: isLocked,
                    lockScalingY: isLocked,
                    lockRotation: isLocked,
                    hasControls: !isLocked,
                    hasBorders: !isLocked,
                    selectable: true
                });
                canvas.renderAll();
                updateTransformProperties();
                updateLayersList();
            }
        });

        document.getElementById('textContent').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                selectedObject.set('text', e.target.value);
                canvas.renderAll();
            }
        });

        document.getElementById('fontFamily').addEventListener('change', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const selectedFont = e.target.value;

                // Set the font family
                selectedObject.set('fontFamily', selectedFont);

                // Force canvas to recognize the font change
                canvas.renderAll();

                // For some fonts, we need to trigger a re-render
                setTimeout(() => {
                    selectedObject.set('fontFamily', selectedFont);
                    canvas.renderAll();
                }, 100);

                console.log('Font changed to:', selectedFont); // For debugging
            }
        });

        document.getElementById('fontSizeSlider').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const size = parseInt(e.target.value);
                selectedObject.set('fontSize', size);
                document.getElementById('fontSizeNumber').value = size;
                canvas.renderAll();
            }
        });

        document.getElementById('fontSizeNumber').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const size = parseInt(e.target.value);
                selectedObject.set('fontSize', size);
                document.getElementById('fontSizeSlider').value = size;
                canvas.renderAll();
            }
        });

        document.getElementById('textColor').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.set('fill', e.target.value);
                document.getElementById('textColorHex').value = e.target.value;
                canvas.renderAll();
            }
        });

        document.getElementById('textOpacitySlider').addEventListener('input', (e) => {
            if (selectedObject) {
                const opacity = parseInt(e.target.value) / 100;
                selectedObject.set('opacity', opacity);
                document.getElementById('textOpacityNumber').value = e.target.value;
                canvas.renderAll();
            }
        });

        document.getElementById('textBold').addEventListener('click', () => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const isBold = selectedObject.fontWeight === 'bold';
                selectedObject.set('fontWeight', isBold ? 'normal' : 'bold');
                document.getElementById('textBold').classList.toggle('active', !isBold);
                canvas.renderAll();
            }
        });

        document.getElementById('textItalic').addEventListener('click', () => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const isItalic = selectedObject.fontStyle === 'italic';
                selectedObject.set('fontStyle', isItalic ? 'normal' : 'italic');
                document.getElementById('textItalic').classList.toggle('active', !isItalic);
                canvas.renderAll();
            }
        });

        document.getElementById('textUnderline').addEventListener('click', () => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                selectedObject.set('underline', !selectedObject.underline);
                document.getElementById('textUnderline').classList.toggle('active', selectedObject.underline);
                canvas.renderAll();
            }
        });

        document.getElementById('textStrikethrough').addEventListener('click', () => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                selectedObject.set('linethrough', !selectedObject.linethrough);
                document.getElementById('textStrikethrough').classList.toggle('active', selectedObject.linethrough);
                canvas.renderAll();
            }
        });

        document.querySelectorAll('.align-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                    document.querySelectorAll('.align-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const alignValue = this.dataset.align;
                    selectedObject.set('textAlign', alignValue);
                    canvas.renderAll();
                }
            });
        });

        document.getElementById('lineHeightSlider').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const value = parseFloat(e.target.value);
                selectedObject.set('lineHeight', value);
                document.getElementById('lineHeightNumber').value = value;
                canvas.renderAll();
            }
        });

        document.getElementById('lineHeightNumber').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const value = parseFloat(e.target.value);
                selectedObject.set('lineHeight', value);
                document.getElementById('lineHeightSlider').value = value;
                canvas.renderAll();
            }
        });

        document.getElementById('letterSpacingSlider').addEventListener('input', (e) => {
            if (selectedObject && (selectedObject.type === 'text' || selectedObject.type === 'textbox' || selectedObject.type === 'i-text')) {
                const value = parseFloat(e.target.value) * 100;
                selectedObject.set('charSpacing', value);
                document.getElementById('letterSpacingNumber').value = e.target.value;
                canvas.renderAll();
            }
        });

        ['posX', 'posY', 'width', 'height', 'rotation'].forEach(prop => {
            const slider = document.getElementById(`${prop}Slider`);
            const number = document.getElementById(`${prop}Number`);
            
            if (slider && number) {
                slider.addEventListener('input', (e) => {
                    if (selectedObject && !selectedObject.lockMovementX) {
                        const value = parseInt(e.target.value);
                        number.value = value;
                        
                        switch(prop) {
                            case 'posX':
                                selectedObject.set('left', value);
                                break;
                            case 'posY':
                                selectedObject.set('top', value);
                                break;
                            case 'width':
                                selectedObject.set('scaleX', value / selectedObject.width);
                                break;
                            case 'height':
                                selectedObject.set('scaleY', value / selectedObject.height);
                                break;
                            case 'rotation':
                                selectedObject.set('angle', value);
                                break;
                        }
                        canvas.renderAll();
                        selectedObject.setCoords();
                    }
                });

                number.addEventListener('input', (e) => {
                    if (selectedObject && !selectedObject.lockMovementX) {
                        const value = parseInt(e.target.value);
                        slider.value = value;
                        
                        switch(prop) {
                            case 'posX':
                                selectedObject.set('left', value);
                                break;
                            case 'posY':
                                selectedObject.set('top', value);
                                break;
                            case 'width':
                                selectedObject.set('scaleX', value / selectedObject.width);
                                break;
                            case 'height':
                                selectedObject.set('scaleY', value / selectedObject.height);
                                break;
                            case 'rotation':
                                selectedObject.set('angle', value);
                                break;
                        }
                        canvas.renderAll();
                        selectedObject.setCoords();
                    }
                });
            }
        });

        document.querySelectorAll('.border-style-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.border-style-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                const style = this.dataset.border;
                const canvasContainer = document.getElementById('canvasContainer');
                if (style === 'none') {
                    canvasContainer.style.border = 'none';
                } else {
                    canvasContainer.style.borderStyle = style;
                    canvasContainer.style.borderWidth = document.getElementById('borderWidthSlider').value + 'px';
                    canvasContainer.style.borderColor = document.getElementById('borderColor').value;
                }
            });
        });

        document.getElementById('borderColor').addEventListener('input', (e) => {
            document.getElementById('canvasContainer').style.borderColor = e.target.value;
            document.getElementById('borderColorHex').value = e.target.value;
        });

        document.getElementById('borderWidthSlider').addEventListener('input', (e) => {
            const width = e.target.value + 'px';
            document.getElementById('canvasContainer').style.borderWidth = width;
            document.getElementById('borderWidthNumber').value = e.target.value;
        });

        document.getElementById('borderRadiusSlider').addEventListener('input', (e) => {
            const radius = e.target.value + 'px';
            document.getElementById('canvasContainer').style.borderRadius = radius;
            document.getElementById('borderRadiusNumber').value = e.target.value;
        });

        document.getElementById('imageUpload').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (f) => {
                    fabric.Image.fromURL(f.target.result, (img) => {
                        img.scaleToWidth(200);
                        img.set({
                            left: 100,
                            top: 100,
                            cornerColor: '#BCAE83',
                            cornerSize: 10,
                            transparentCorners: false
                        });
                        canvas.add(img);
                        canvas.renderAll();
                        updateLayersList();
                        saveState();
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        document.querySelectorAll('.graphic-item').forEach(item => {
            item.addEventListener('click', () => {
                const graphic = item.dataset.graphic;
                let text = '';
                switch(graphic) {
                    case 'heart': text = 'â¤ï¸'; break;
                    case 'star': text = 'â­'; break;
                    case 'flower': text = 'ð¸'; break;
                    case 'crown': text = 'ð'; break;
                    case 'diamond': text = 'ð'; break;
                    case 'circle': text = 'â'; break;
                    case 'square': text = 'â '; break;
                    case 'triangle': text = 'â²'; break;
                    case 'ribbon': text = 'ð'; break;
                }
                
                const graphicText = new fabric.Text(text, {
                    left: 100,
                    top: 100,
                    fontSize: 50,
                    fontFamily: 'Segoe UI',
                    fill: '#BCAE83',
                    selectable: true,
                    hasControls: true,
                    hasBorders: true
                });
                canvas.add(graphicText);
                canvas.renderAll();
                updateLayersList();
                saveState();
            });
        });

        function updateLayersList() {
            const layersList = document.getElementById('layersList');
            const objects = canvas.getObjects();
            
            layersList.innerHTML = '';
            objects.slice().reverse().forEach((obj, index) => {
                const layerDiv = document.createElement('div');
                layerDiv.className = `layer-item ${obj === selectedObject ? 'active' : ''}`;
                layerDiv.dataset.index = objects.length - 1 - index;
                
                let icon = 'font';
                if (obj.type === 'image') icon = 'image';
                else if (obj.type === 'rect' || obj.type === 'circle' || obj.type === 'triangle') icon = 'shapes';
                
                layerDiv.innerHTML = `
                    <span class="layer-icon"><i class="fas fa-${icon}"></i></span>
                    <span class="layer-name">${obj.type} ${index + 1}${obj.lockMovementX ? ' ð' : ''}</span>
                    <div class="layer-actions">
                        <button class="layer-action-btn" onclick="event.stopPropagation(); duplicateLayer(${objects.length - 1 - index})"><i class="fas fa-copy"></i></button>
                        <button class="layer-action-btn" onclick="event.stopPropagation(); deleteLayer(${objects.length - 1 - index})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                layerDiv.addEventListener('click', () => {
                    canvas.setActiveObject(obj);
                    canvas.renderAll();
                });
                
                layersList.appendChild(layerDiv);
            });
        }

        window.duplicateLayer = (index) => {
            const objects = canvas.getObjects();
            const obj = objects[index];
            if (obj) {
                obj.clone((cloned) => {
                    cloned.set({
                        left: obj.left + 20,
                        top: obj.top + 20,
                        lockMovementX: false,
                        lockMovementY: false,
                        hasControls: true,
                        hasBorders: true
                    });
                    canvas.add(cloned);
                    canvas.renderAll();
                    updateLayersList();
                    saveState();
                });
            }
        };

        window.deleteLayer = (index) => {
            const objects = canvas.getObjects();
            const obj = objects[index];
            if (obj) {
                canvas.remove(obj);
                canvas.renderAll();
                updateLayersList();
                saveState();
            }
        };

        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const tool = this.dataset.tool;
                switch(tool) {
                    case 'select':
                        canvas.selection = true;
                        canvas.defaultCursor = 'default';
                        break;
                    case 'text':
                        const text = new fabric.Text('New Text', {
                            left: 100,
                            top: 100,
                            fontSize: 30,
                            fontFamily: 'Playfair Display',
                            fill: '#333333',
                            selectable: true,
                            hasControls: true,
                            hasBorders: true
                        });
                        canvas.add(text);
                        canvas.setActiveObject(text);
                        canvas.renderAll();
                        updateLayersList();
                        saveState();
                        break;
                    case 'image':
                        document.getElementById('fileInput').click();
                        break;
                    case 'shape':
                        const rect = new fabric.Rect({
                            left: 100,
                            top: 100,
                            width: 100,
                            height: 100,
                            fill: '#BCAE83',
                            stroke: '#000000',
                            strokeWidth: 2,
                            selectable: true,
                            hasControls: true,
                            hasBorders: true
                        });
                        canvas.add(rect);
                        canvas.setActiveObject(rect);
                        canvas.renderAll();
                        updateLayersList();
                        saveState();
                        break;
                    case 'graphic':
                        // Graphics are handled by the grid clicks
                        break;
                    case 'duplicate':
                        if (selectedObject) {
                            selectedObject.clone((cloned) => {
                                cloned.set({
                                    left: selectedObject.left + 20,
                                    top: selectedObject.top + 20,
                                    lockMovementX: false,
                                    lockMovementY: false,
                                    hasControls: true,
                                    hasBorders: true
                                });
                                canvas.add(cloned);
                                canvas.setActiveObject(cloned);
                                canvas.renderAll();
                                updateLayersList();
                                saveState();
                            });
                        }
                        break;
                    case 'delete':
                        if (selectedObject) {
                            canvas.remove(selectedObject);
                            selectedObject = null;
                            canvas.renderAll();
                            updateLayersList();
                            hideAllPropertySections();
                            saveState();
                        }
                        break;
                    case 'undo':
                        if (undoStack.length > 0) {
                            redoStack.push(JSON.stringify(canvas));
                            const previousState = undoStack.pop();
                            canvas.loadFromJSON(previousState, () => {
                                canvas.renderAll();
                                updateLayersList();
                            });
                        }
                        break;
                    case 'redo':
                        if (redoStack.length > 0) {
                            undoStack.push(JSON.stringify(canvas));
                            const nextState = redoStack.pop();
                            canvas.loadFromJSON(nextState, () => {
                                canvas.renderAll();
                                updateLayersList();
                            });
                        }
                        break;
                }
            });
        });

        document.getElementById('zoomIn').addEventListener('click', () => {
            zoomLevel = Math.min(zoomLevel + 0.1, 3);
            updateZoom();
        });

        document.getElementById('zoomOut').addEventListener('click', () => {
            zoomLevel = Math.max(zoomLevel - 0.1, 0.5);
            updateZoom();
        });

        document.getElementById('zoomFit').addEventListener('click', () => {
            zoomLevel = 1;
            updateZoom();
        });

        function updateZoom() {
            canvas.setDimensions({
                width: 600 * zoomLevel,
                height: 450 * zoomLevel
            });
            canvas.renderAll();
            document.getElementById('zoomLevel').textContent = Math.round(zoomLevel * 100) + '%';
        }

        document.querySelectorAll('.page-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                if (currentPage === 'front') {
                    frontCanvasState = JSON.stringify(canvas);
                } else {
                    backCanvasState = JSON.stringify(canvas);
                }
                
                currentPage = this.dataset.page;
                
                if (currentPage === 'back') {
                    if (backCanvasState) {
                        canvas.loadFromJSON(backCanvasState, () => {
                            canvas.renderAll();
                            updateLayersList();
                        });
                    } else {
                        canvas.clear();
                        const backText = new fabric.Text('Back of Card', {
                            left: 200,
                            top: 200,
                            fontSize: 24,
                            fontFamily: 'Playfair Display',
                            fill: '#999999',
                            selectable: true,
                            hasControls: true,
                            hasBorders: true
                        });
                        canvas.add(backText);
                        canvas.renderAll();
                        updateLayersList();
                    }
                    document.getElementById('canvasContainer').style.backgroundColor = '#f8f8f8';
                } else {
                    if (frontCanvasState) {
                        canvas.loadFromJSON(frontCanvasState, () => {
                            canvas.renderAll();
                            updateLayersList();
                        });
                    } else {
                        initializeCard();
                    }
                    document.getElementById('canvasContainer').style.backgroundColor = '#f0f0f0';
                }
            });
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const designData = {
                front: frontCanvasState || JSON.stringify(canvas),
                back: backCanvasState,
                border: {
                    style: document.querySelector('.border-style-option.active')?.dataset.border || 'none',
                    color: document.getElementById('borderColor').value,
                    width: document.getElementById('borderWidthSlider').value,
                    radius: document.getElementById('borderRadiusSlider').value
                },
                page: currentPage,
                template: document.getElementById('templateName').textContent
            };
            
            localStorage.setItem('papirCardDesign', JSON.stringify(designData));
            alert('Design saved successfully!');
        });

        document.getElementById('previewBtn').addEventListener('click', () => {
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1,
                multiplier: 2
            });
            
            document.getElementById('previewImage').src = dataURL;
            document.getElementById('previewModal').style.display = 'flex';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Reset all changes?')) {
                if (currentPage === 'front') {
                    initializeCard();
                } else {
                    canvas.clear();
                    const backText = new fabric.Text('Back of Card', {
                        left: 200,
                        top: 200,
                        fontSize: 24,
                        fontFamily: 'Playfair Display',
                        fill: '#999999',
                        selectable: true,
                        hasControls: true,
                        hasBorders: true
                    });
                    canvas.add(backText);
                    canvas.renderAll();
                    updateLayersList();
                }
                
                document.querySelectorAll('.border-style-option').forEach(opt => opt.classList.remove('active'));
                document.querySelector('[data-border="none"]').classList.add('active');
                document.getElementById('canvasContainer').style.border = 'none';
                document.getElementById('borderColor').value = '#D4AF37';
                document.getElementById('borderColorHex').value = '#D4AF37';
                document.getElementById('borderWidthSlider').value = 3;
                document.getElementById('borderWidthNumber').value = 3;
                document.getElementById('borderRadiusSlider').value = 0;
                document.getElementById('borderRadiusNumber').value = 0;
                
                saveState();
            }
        });

        canvas.on('object:added', updateLayersList);
        canvas.on('object:removed', updateLayersList);
        canvas.on('object:modified', updateLayersList);

    document.getElementById('closePreviewBtn').addEventListener('click', function() {
        document.getElementById('previewModal').style.display = 'none';
     });
        
    </script>
</body>
</html>



