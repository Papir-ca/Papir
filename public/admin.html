<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Papir Admin - Card Management</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #1a1a1a; color: white; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #BCAE83; margin-bottom: 30px; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: #2a2a2a; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 2rem; color: #BCAE83; font-weight: bold; }
        .cards-table { width: 100%; background: #2a2a2a; border-radius: 10px; overflow: hidden; }
        th { background: #364B4A; padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #444; }
        .action-btn { padding: 5px 10px; margin: 0 5px; border: none; border-radius: 5px; cursor: pointer; }
        .view-btn { background: #BCAE83; color: black; }
        .qr-btn { background: #364B4A; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Papir Admin Dashboard</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalCards">0</div>
                <div>Total Cards</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="videoCards">0</div>
                <div>Video Cards</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="imageCards">0</div>
                <div>Image Cards</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="audioCards">0</div>
                <div>Audio Cards</div>
            </div>
        </div>
        
        <table class="cards-table">
            <thead>
                <tr>
                    <th>Card ID</th>
                    <th>Type</th>
                    <th>File</th>
                    <th>Size</th>
                    <th>Created</th>
                    <th>IP Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="cardsTableBody">
                <!-- Cards will load here -->
            </tbody>
        </table>
    </div>
    
    <script>
        const BACKEND_URL = 'https://papir.ca';
        
        async function loadAdminData() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/cards`);
                const result = await response.json();
                
                if (result.success && result.cards) {
                    updateStats(result.cards);
                    displayCards(result.cards);
                }
            } catch (error) {
                console.error('Admin load error:', error);
            }
        }
        
        function updateStats(cards) {
            document.getElementById('totalCards').textContent = cards.length;
            document.getElementById('videoCards').textContent = cards.filter(c => c.message_type === 'video').length;
            document.getElementById('imageCards').textContent = cards.filter(c => c.message_type === 'image').length;
            document.getElementById('audioCards').textContent = cards.filter(c => c.message_type === 'audio').length;
        }
        
        function displayCards(cards) {
            const tbody = document.getElementById('cardsTableBody');
            tbody.innerHTML = '';
            
            cards.forEach(card => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${card.card_id}</strong></td>
                    <td>${card.message_type}</td>
                    <td>${card.file_name || 'N/A'}</td>
                    <td>${card.file_size ? Math.round(card.file_size / 1024) + ' KB' : 'N/A'}</td>
                    <td>${new Date(card.created_at).toLocaleDateString()}</td>
                    <td>${card.created_by_ip || 'N/A'}</td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewCard('${card.card_id}')">View</button>
                        <button class="action-btn qr-btn" onclick="showQR('${card.card_id}')">QR</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function viewCard(cardId) {
            window.open(`${BACKEND_URL}/viewer.html?card=${cardId}`, '_blank');
        }
        
        function showQR(cardId) {
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`${BACKEND_URL}/viewer.html?card=${cardId}`)}`;
            window.open(qrUrl, '_blank');
        }
        
        // Load data on page load
        loadAdminData();
        // Refresh every 30 seconds
        setInterval(loadAdminData, 30000);
    </script>
</body>
</html>